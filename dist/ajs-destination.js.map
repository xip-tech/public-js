{"version":3,"file":"ajs-destination.js","mappings":"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","sources":["webpack://xip-public-js/./node_modules/@segment/analytics-next/dist/pkg/lib/is-plan-event-enabled.js","webpack://xip-public-js/./node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/loader.js","webpack://xip-public-js/./node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/utils.js","webpack://xip-public-js/./node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/index.js"],"sourcesContent":["/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nexport function isPlanEventEnabled(plan, planEvent) {\n    var _a, _b;\n    // Always prioritize the event's `enabled` status\n    if (typeof (planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) === 'boolean') {\n        return planEvent.enabled;\n    }\n    // Assume absence of a tracking plan means events are enabled\n    return (_b = (_a = plan === null || plan === void 0 ? void 0 : plan.__default) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n}\n//# sourceMappingURL=is-plan-event-enabled.js.map","import { __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nimport { loadScript, unloadScript } from '../../lib/load-script';\nfunction normalizeName(name) {\n    return name.toLowerCase().replace('.', '').replace(/\\s+/g, '-');\n}\nfunction obfuscatePathName(pathName, obfuscate) {\n    if (obfuscate === void 0) { obfuscate = false; }\n    return obfuscate ? btoa(pathName).replace(/=/g, '') : undefined;\n}\nexport function resolveIntegrationNameFromSource(integrationSource) {\n    return ('Integration' in integrationSource\n        ? integrationSource.Integration\n        : integrationSource).prototype.name;\n}\nfunction recordLoadMetrics(fullPath, ctx, name) {\n    var _a, _b;\n    try {\n        var metric = ((_b = (_a = window === null || window === void 0 ? void 0 : window.performance) === null || _a === void 0 ? void 0 : _a.getEntriesByName(fullPath, 'resource')) !== null && _b !== void 0 ? _b : [])[0];\n        // we assume everything that took under 100ms is cached\n        metric &&\n            ctx.stats.gauge('legacy_destination_time', Math.round(metric.duration), __spreadArray([\n                name\n            ], (metric.duration < 100 ? ['cached'] : []), true));\n    }\n    catch (_) {\n        // not available\n    }\n}\nexport function buildIntegration(integrationSource, integrationSettings, analyticsInstance) {\n    var integrationCtr;\n    // GA and Appcues use a different interface to instantiating integrations\n    if ('Integration' in integrationSource) {\n        var analyticsStub = {\n            user: function () { return analyticsInstance.user(); },\n            addIntegration: function () { },\n        };\n        integrationSource(analyticsStub);\n        integrationCtr = integrationSource.Integration;\n    }\n    else {\n        integrationCtr = integrationSource;\n    }\n    var integration = new integrationCtr(integrationSettings);\n    integration.analytics = analyticsInstance;\n    return integration;\n}\nexport function loadIntegration(ctx, name, version, obfuscate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var pathName, obfuscatedPathName, path, fullPath, err_1, deps;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    pathName = normalizeName(name);\n                    obfuscatedPathName = obfuscatePathName(pathName, obfuscate);\n                    path = getNextIntegrationsURL();\n                    fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, loadScript(fullPath)];\n                case 2:\n                    _a.sent();\n                    recordLoadMetrics(fullPath, ctx, name);\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_1 = _a.sent();\n                    ctx.stats.gauge('legacy_destination_time', -1, [\"plugin:\".concat(name), \"failed\"]);\n                    throw err_1;\n                case 4:\n                    deps = window[\"\".concat(pathName, \"Deps\")];\n                    return [4 /*yield*/, Promise.all(deps.map(function (dep) { return loadScript(path + dep + '.gz'); }))\n                        // @ts-ignore\n                    ];\n                case 5:\n                    _a.sent();\n                    // @ts-ignore\n                    window[\"\".concat(pathName, \"Loader\")]();\n                    return [2 /*return*/, window[\n                        // @ts-ignore\n                        \"\".concat(pathName, \"Integration\")]];\n            }\n        });\n    });\n}\nexport function unloadIntegration(name, version, obfuscate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var path, pathName, obfuscatedPathName, fullPath;\n        return __generator(this, function (_a) {\n            path = getNextIntegrationsURL();\n            pathName = normalizeName(name);\n            obfuscatedPathName = obfuscatePathName(name, obfuscate);\n            fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n            return [2 /*return*/, unloadScript(fullPath)];\n        });\n    });\n}\nexport function resolveVersion(settings) {\n    var _a, _b, _c, _d;\n    return ((_d = (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _a === void 0 ? void 0 : _a.override) !== null && _b !== void 0 ? _b : (_c = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _c === void 0 ? void 0 : _c.version) !== null && _d !== void 0 ? _d : 'latest');\n}\n//# sourceMappingURL=loader.js.map","export var isInstallableIntegration = function (name, integrationSettings) {\n    var _a;\n    var type = integrationSettings.type, bundlingStatus = integrationSettings.bundlingStatus, versionSettings = integrationSettings.versionSettings;\n    // We use `!== 'unbundled'` (versus `=== 'bundled'`) to be inclusive of\n    // destinations without a defined value for `bundlingStatus`\n    var deviceMode = bundlingStatus !== 'unbundled' &&\n        (type === 'browser' || ((_a = versionSettings === null || versionSettings === void 0 ? void 0 : versionSettings.componentTypes) === null || _a === void 0 ? void 0 : _a.includes('browser')));\n    // checking for iterable is a quick fix we need in place to prevent\n    // errors showing Iterable as a failed destiantion. Ideally, we should\n    // fix the Iterable metadata instead, but that's a longer process.\n    return !name.startsWith('Segment') && name !== 'Iterable' && deviceMode;\n};\nexport var isDisabledIntegration = function (integrationName, globalIntegrations) {\n    var allDisableAndNotDefined = globalIntegrations.All === false &&\n        globalIntegrations[integrationName] === undefined;\n    return (globalIntegrations[integrationName] === false || allDisableAndNotDefined);\n};\n//# sourceMappingURL=utils.js.map","import { __assign, __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { Alias, Group, Identify, Page, Track } from '@segment/facade';\nimport { isOffline, isOnline } from '../../core/connection';\nimport { Context, ContextCancelation } from '../../core/context';\nimport { isServer } from '../../core/environment';\nimport { attempt } from '@segment/analytics-core';\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled';\nimport { mergedOptions } from '../../lib/merged-options';\nimport { pWhile } from '../../lib/p-while';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { applyDestinationMiddleware, } from '../middleware';\nimport { buildIntegration, loadIntegration, resolveIntegrationNameFromSource, resolveVersion, unloadIntegration, } from './loader';\nimport { isPlainObject } from '@segment/analytics-core';\nimport { isDisabledIntegration as shouldSkipIntegration, isInstallableIntegration, } from './utils';\nfunction flushQueue(xt, queue) {\n    return __awaiter(this, void 0, void 0, function () {\n        var failedQueue;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    failedQueue = [];\n                    if (isOffline()) {\n                        return [2 /*return*/, queue];\n                    }\n                    return [4 /*yield*/, pWhile(function () { return queue.length > 0 && isOnline(); }, function () { return __awaiter(_this, void 0, void 0, function () {\n                            var ctx, result, success;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        ctx = queue.pop();\n                                        if (!ctx) {\n                                            return [2 /*return*/];\n                                        }\n                                        return [4 /*yield*/, attempt(ctx, xt)];\n                                    case 1:\n                                        result = _a.sent();\n                                        success = result instanceof Context;\n                                        if (!success) {\n                                            failedQueue.push(ctx);\n                                        }\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); })\n                        // re-add failed tasks\n                    ];\n                case 1:\n                    _a.sent();\n                    // re-add failed tasks\n                    failedQueue.map(function (failed) { return queue.pushWithBackoff(failed); });\n                    return [2 /*return*/, queue];\n            }\n        });\n    });\n}\nvar LegacyDestination = /** @class */ (function () {\n    function LegacyDestination(name, version, writeKey, settings, options, integrationSource) {\n        if (settings === void 0) { settings = {}; }\n        this.options = {};\n        this.type = 'destination';\n        this.middleware = [];\n        this._ready = false;\n        this._initialized = false;\n        this.flushing = false;\n        this.name = name;\n        this.version = version;\n        this.settings = __assign({}, settings);\n        this.disableAutoISOConversion = options.disableAutoISOConversion || false;\n        this.integrationSource = integrationSource;\n        // AJS-Renderer sets an extraneous `type` setting that clobbers\n        // existing type defaults. We need to remove it if it's present\n        if (this.settings['type'] && this.settings['type'] === 'browser') {\n            delete this.settings['type'];\n        }\n        this.options = options;\n        this.buffer = options.disableClientPersistence\n            ? new PriorityQueue(4, [])\n            : new PersistedPriorityQueue(4, \"\".concat(writeKey, \":dest-\").concat(name));\n        this.scheduleFlush();\n    }\n    LegacyDestination.prototype.isLoaded = function () {\n        return this._ready;\n    };\n    LegacyDestination.prototype.ready = function () {\n        var _a;\n        return (_a = this.onReady) !== null && _a !== void 0 ? _a : Promise.resolve();\n    };\n    LegacyDestination.prototype.load = function (ctx, analyticsInstance) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var integrationSource, _b;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (this._ready || this.onReady !== undefined) {\n                            return [2 /*return*/];\n                        }\n                        if (!((_a = this.integrationSource) !== null && _a !== void 0)) return [3 /*break*/, 1];\n                        _b = _a;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, loadIntegration(ctx, this.name, this.version, this.options.obfuscate)];\n                    case 2:\n                        _b = (_c.sent());\n                        _c.label = 3;\n                    case 3:\n                        integrationSource = _b;\n                        this.integration = buildIntegration(integrationSource, this.settings, analyticsInstance);\n                        this.onReady = new Promise(function (resolve) {\n                            var onReadyFn = function () {\n                                _this._ready = true;\n                                resolve(true);\n                            };\n                            _this.integration.once('ready', onReadyFn);\n                        });\n                        this.onInitialize = new Promise(function (resolve) {\n                            var onInit = function () {\n                                _this._initialized = true;\n                                resolve(true);\n                            };\n                            _this.integration.on('initialize', onInit);\n                        });\n                        try {\n                            ctx.stats.increment('analytics_js.integration.invoke', 1, [\n                                \"method:initialize\",\n                                \"integration_name:\".concat(this.name),\n                            ]);\n                            this.integration.initialize();\n                        }\n                        catch (error) {\n                            ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\n                                \"method:initialize\",\n                                \"integration_name:\".concat(this.name),\n                            ]);\n                            throw error;\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.unload = function (_ctx, _analyticsInstance) {\n        return unloadIntegration(this.name, this.version, this.options.obfuscate);\n    };\n    LegacyDestination.prototype.addMiddleware = function () {\n        var _a;\n        var fn = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            fn[_i] = arguments[_i];\n        }\n        this.middleware = (_a = this.middleware).concat.apply(_a, fn);\n    };\n    LegacyDestination.prototype.shouldBuffer = function (ctx) {\n        return (\n        // page events can't be buffered because of destinations that automatically add page views\n        ctx.event.type !== 'page' &&\n            (isOffline() || this._ready === false || this._initialized === false));\n    };\n    LegacyDestination.prototype.send = function (ctx, clz, eventType) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function () {\n            var plan, ev, planEvent, afterMiddleware, event, err_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (this.shouldBuffer(ctx)) {\n                            this.buffer.push(ctx);\n                            this.scheduleFlush();\n                            return [2 /*return*/, ctx];\n                        }\n                        plan = (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.plan) === null || _b === void 0 ? void 0 : _b.track;\n                        ev = ctx.event.event;\n                        if (plan && ev && this.name !== 'Segment.io') {\n                            planEvent = plan[ev];\n                            if (!isPlanEventEnabled(plan, planEvent)) {\n                                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), { All: false, 'Segment.io': true }));\n                                ctx.cancel(new ContextCancelation({\n                                    retry: false,\n                                    reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                                    type: 'Dropped by plan',\n                                }));\n                                return [2 /*return*/, ctx];\n                            }\n                            else {\n                                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations));\n                            }\n                            if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) && (planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations[this.name]) === false) {\n                                ctx.cancel(new ContextCancelation({\n                                    retry: false,\n                                    reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                                    type: 'Dropped by plan',\n                                }));\n                                return [2 /*return*/, ctx];\n                            }\n                        }\n                        return [4 /*yield*/, applyDestinationMiddleware(this.name, ctx.event, this.middleware)];\n                    case 1:\n                        afterMiddleware = _c.sent();\n                        if (afterMiddleware === null) {\n                            return [2 /*return*/, ctx];\n                        }\n                        event = new clz(afterMiddleware, {\n                            traverse: !this.disableAutoISOConversion,\n                        });\n                        ctx.stats.increment('analytics_js.integration.invoke', 1, [\n                            \"method:\".concat(eventType),\n                            \"integration_name:\".concat(this.name),\n                        ]);\n                        _c.label = 2;\n                    case 2:\n                        _c.trys.push([2, 5, , 6]);\n                        if (!this.integration) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.integration.invoke.call(this.integration, eventType, event)];\n                    case 3:\n                        _c.sent();\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        err_1 = _c.sent();\n                        ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\n                            \"method:\".concat(eventType),\n                            \"integration_name:\".concat(this.name),\n                        ]);\n                        throw err_1;\n                    case 6: return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.track = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Track, 'track')];\n            });\n        });\n    };\n    LegacyDestination.prototype.page = function (ctx) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_b) {\n                if (((_a = this.integration) === null || _a === void 0 ? void 0 : _a._assumesPageview) && !this._initialized) {\n                    this.integration.initialize();\n                }\n                return [2 /*return*/, this.onInitialize.then(function () {\n                        return _this.send(ctx, Page, 'page');\n                    })];\n            });\n        });\n    };\n    LegacyDestination.prototype.identify = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Identify, 'identify')];\n            });\n        });\n    };\n    LegacyDestination.prototype.alias = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Alias, 'alias')];\n            });\n        });\n    };\n    LegacyDestination.prototype.group = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Group, 'group')];\n            });\n        });\n    };\n    LegacyDestination.prototype.scheduleFlush = function () {\n        var _this = this;\n        if (this.flushing) {\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this.flushing = true;\n                        _a = this;\n                        return [4 /*yield*/, flushQueue(this, this.buffer)];\n                    case 1:\n                        _a.buffer = _b.sent();\n                        this.flushing = false;\n                        if (this.buffer.todo > 0) {\n                            this.scheduleFlush();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); }, Math.random() * 5000);\n    };\n    return LegacyDestination;\n}());\nexport { LegacyDestination };\nexport function ajsDestinations(writeKey, settings, globalIntegrations, options, routingMiddleware, legacyIntegrationSources) {\n    var _a, _b;\n    if (globalIntegrations === void 0) { globalIntegrations = {}; }\n    if (options === void 0) { options = {}; }\n    if (isServer()) {\n        return [];\n    }\n    if (settings.plan) {\n        options = options !== null && options !== void 0 ? options : {};\n        options.plan = settings.plan;\n    }\n    var routingRules = (_b = (_a = settings.middlewareSettings) === null || _a === void 0 ? void 0 : _a.routingRules) !== null && _b !== void 0 ? _b : [];\n    var remoteIntegrationsConfig = settings.integrations;\n    var localIntegrationsConfig = options.integrations;\n    // merged remote CDN settings with user provided options\n    var integrationOptions = mergedOptions(settings, options !== null && options !== void 0 ? options : {});\n    var adhocIntegrationSources = legacyIntegrationSources === null || legacyIntegrationSources === void 0 ? void 0 : legacyIntegrationSources.reduce(function (acc, integrationSource) {\n        var _a;\n        return (__assign(__assign({}, acc), (_a = {}, _a[resolveIntegrationNameFromSource(integrationSource)] = integrationSource, _a)));\n    }, {});\n    var installableIntegrations = new Set(__spreadArray(__spreadArray([], Object.keys(remoteIntegrationsConfig).filter(function (name) {\n        return isInstallableIntegration(name, remoteIntegrationsConfig[name]);\n    }), true), Object.keys(adhocIntegrationSources || {}).filter(function (name) {\n        return isPlainObject(remoteIntegrationsConfig[name]) ||\n            isPlainObject(localIntegrationsConfig === null || localIntegrationsConfig === void 0 ? void 0 : localIntegrationsConfig[name]);\n    }), true));\n    return Array.from(installableIntegrations)\n        .filter(function (name) { return !shouldSkipIntegration(name, globalIntegrations); })\n        .map(function (name) {\n        var integrationSettings = remoteIntegrationsConfig[name];\n        var version = resolveVersion(integrationSettings);\n        var destination = new LegacyDestination(name, version, writeKey, integrationOptions[name], options, adhocIntegrationSources === null || adhocIntegrationSources === void 0 ? void 0 : adhocIntegrationSources[name]);\n        var routing = routingRules.filter(function (rule) { return rule.destinationName === name; });\n        if (routing.length > 0 && routingMiddleware) {\n            destination.addMiddleware(routingMiddleware);\n        }\n        return destination;\n    });\n}\n//# sourceMappingURL=index.js.map"],"names":["isPlanEventEnabled","plan","planEvent","_a","_b","enabled","__default","normalizeName","name","toLowerCase","replace","obfuscatePathName","pathName","obfuscate","btoa","undefined","loadIntegration","ctx","version","this","obfuscatedPathName","path","fullPath","err_1","deps","label","concat","trys","push","sent","metric","window","performance","getEntriesByName","stats","gauge","Math","round","duration","_","recordLoadMetrics","Promise","all","map","dep","isInstallableIntegration","integrationSettings","type","bundlingStatus","versionSettings","deviceMode","componentTypes","includes","startsWith","isDisabledIntegration","integrationName","globalIntegrations","allDisableAndNotDefined","All","flushQueue","xt","queue","failedQueue","_this","length","pop","a","failed","pushWithBackoff","LegacyDestination","writeKey","settings","options","integrationSource","middleware","_ready","_initialized","flushing","disableAutoISOConversion","buffer","disableClientPersistence","scheduleFlush","prototype","isLoaded","ready","onReady","resolve","load","analyticsInstance","_c","integration","integrationCtr","user","addIntegration","Integration","analytics","buildIntegration","once","onInitialize","on","increment","initialize","error","unload","_ctx","_analyticsInstance","unloadIntegration","addMiddleware","fn","_i","arguments","apply","shouldBuffer","event","send","clz","eventType","ev","afterMiddleware","track","updateEvent","integrations","cancel","retry","reason","applyDestinationMiddleware","traverse","invoke","call","Track","page","_assumesPageview","then","Page","identify","Identify","alias","Alias","group","Group","setTimeout","todo","random","ajsDestinations","routingMiddleware","legacyIntegrationSources","routingRules","middlewareSettings","remoteIntegrationsConfig","localIntegrationsConfig","integrationOptions","adhocIntegrationSources","reduce","acc","resolveIntegrationNameFromSource","installableIntegrations","Set","Object","keys","filter","Array","from","_d","override","resolveVersion","destination","rule","destinationName"],"sourceRoot":""}